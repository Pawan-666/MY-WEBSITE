<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta charset="utf-8">
  
  <title>Cloudwatch</title>
  
  <title>MyBlog</title>
  <!-- <link href="/style.css" rel="stylesheet"/> -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link href="/style.css" rel="stylesheet"/>
</head>

<body>
  <nav>
</p>
<p style="font-size:25px;"><a href="/blog">Blogs</a>        <a href="/contact">contact</a>
    <!-- <a href="/blog">Blogs</a> -->
    <!-- <a href="/">Home</a> -->
    <!-- <a href="/about">About</a> -->
    <!-- <a href="/contact">Contact</a> -->
  <nav>
  <hr>
  <section class="section">
    <div class="container">
      
<h1 class="title">
  Cloudwatch
</h1>
<p class="subtitle"><strong>2023-09-27</strong></p>
<p><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html">AWS_docs_AmazonCloudWatch</a></p>
<ul>
<li><a href="https://pawanchhetri.com.np/blog/cloudwatch/#metrics-monitoring-timing">Metrics monitoring timing</a></li>
<li><a href="https://pawanchhetri.com.np/blog/cloudwatch/#python-script">python script</a></li>
<li><a href="https://pawanchhetri.com.np/blog/cloudwatch/#setting-alarms">Setting alarms</a></li>
</ul>
<h3 id="metrics-monitoring-timing">Metrics monitoring timing</h3>
<p>Normally metrics are sent per 5 mins but if we enable detailed monitoring, it is enabled for every 1 min.
<img src="/images/2023-09-27-18-42-47.png" alt="" />
<img src="/images/2023-09-27-18-43-26.png" alt="" /></p>
<h3 id="python-script">python script</h3>
<p><code>python3 should be installed inside the server, this script will increase CPU above 50%-100% for minutes or so.</code></p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>time
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">simulate_cpu_spike</span><span>(</span><span style="color:#bf616a;">duration</span><span>=</span><span style="color:#d08770;">30</span><span>, </span><span style="color:#bf616a;">cpu_percent</span><span>=</span><span style="color:#d08770;">80</span><span>):
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">Simulating CPU spike at </span><span>{cpu_percent}</span><span style="color:#a3be8c;">%...</span><span>&quot;)
</span><span>    start_time = time.</span><span style="color:#bf616a;">time</span><span>()
</span><span>
</span><span>    </span><span style="color:#65737e;"># Calculate the number of iterations needed to achieve the desired CPU utilization
</span><span>    target_percent = cpu_percent / </span><span style="color:#d08770;">100
</span><span>    total_iterations = </span><span style="color:#bf616a;">int</span><span>(target_percent * </span><span style="color:#d08770;">5_000_000</span><span>)  </span><span style="color:#65737e;"># Adjust the number as needed
</span><span>
</span><span>    </span><span style="color:#65737e;"># Perform simple arithmetic operations to spike CPU utilization
</span><span>    </span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">_ </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">range</span><span>(total_iterations):
</span><span>        result = </span><span style="color:#d08770;">0
</span><span>        </span><span style="color:#b48ead;">for </span><span>i </span><span style="color:#b48ead;">in </span><span style="color:#96b5b4;">range</span><span>(</span><span style="color:#d08770;">1</span><span>, </span><span style="color:#d08770;">1001</span><span>):
</span><span>            result += i
</span><span>
</span><span>    </span><span style="color:#65737e;"># Wait for the rest of the time interval
</span><span>    elapsed_time = time.</span><span style="color:#bf616a;">time</span><span>() - start_time
</span><span>    remaining_time = </span><span style="color:#96b5b4;">max</span><span>(</span><span style="color:#d08770;">0</span><span>, duration - elapsed_time)
</span><span>    time.</span><span style="color:#bf616a;">sleep</span><span>(remaining_time)
</span><span>
</span><span>    </span><span style="color:#96b5b4;">print</span><span>(&quot;</span><span style="color:#a3be8c;">CPU spike simulation completed.</span><span>&quot;)
</span><span>
</span><span style="color:#b48ead;">if </span><span>__name__ == &#39;</span><span style="color:#a3be8c;">__main__</span><span>&#39;:
</span><span>    </span><span style="color:#65737e;"># Simulate a CPU spike for 30 seconds with 80% CPU utilization
</span><span>    </span><span style="color:#bf616a;">simulate_cpu_spike</span><span>(</span><span style="color:#bf616a;">duration</span><span>=</span><span style="color:#d08770;">30</span><span>, </span><span style="color:#bf616a;">cpu_percent</span><span>=</span><span style="color:#d08770;">80</span><span>)
</span></code></pre>
<h3 id="setting-alarms">Setting alarms</h3>
<p><img src="/images/2023-09-27-19-04-04.png" alt="" />
5s is the auto refresh time to fetch the metrics data to the graph and the below 5mins shows the data of the last 5 mins in terms of max,average,min  whatever we choose.</p>
<p>We can set alarms from following options</p>
<ol>
<li>Cloudwatch - In_alarm/All_alarms - Create Alarm</li>
<li>Cloudwatch - All_metrics - Graphed_metrics - Actions(alarm icon)</li>
<li>Instances - monitoring - CPU_utilization-view_in_metrics - Graphed_metrics - Actions(alarm icon)</li>
</ol>
<p><img src="/images/2023-09-27-19-47-26.png" alt="" /></p>
<ol>
<li>Step 1 - Specify metric and conditions
<img src="/images/2023-09-27-19-48-15.png" alt="" /></li>
</ol>
<p>Datapoints to Alarm is the number of data points within the Evaluation Periods that must be breaching to cause the alarm to go to the ALARM state. The breaching data points don't have to be consecutive, but they must all be within the last number of data points equal to Evaluation Period.
<img src="/images/2023-09-27-20-06-44.png" alt="" /></p>
<p>When you configure Evaluation Periods and Datapoints to Alarm as different values, you're setting an &quot;M out of N&quot; alarm. Datapoints to Alarm is (&quot;M&quot;) and Evaluation Periods is (&quot;N&quot;). The evaluation interval is the number of evaluation periods multiplied by the period length. For example, if you configure 4 out of 5 data points with a period of 1 minute, the evaluation interval is 5 minutes. If you configure 3 out of 3 data points with a period of 5 minutes, the evaluation interval is 15 minutes as in above image.</p>
<ol start="2">
<li>Step 2 - Configure actions
Either choose existing SNS topic or create new one.
<img src="/images/2023-09-27-20-18-34.png" alt="" /></li>
</ol>
<p>After alarm is set
<img src="/images/2023-09-27-20-29-24.png" alt="" />
<img src="/images/2023-09-27-20-26-11.png" alt="" />
<img src="/images/2023-09-27-20-30-59.png" alt="" />
<img src="/images/2023-09-27-20-29-54.png" alt="" />
<img src="/images/2023-09-27-20-42-29.png" alt="" /></p>
<p>After increasing the CPU utilization(running the above script here)
<img src="/images/2023-09-27-20-37-18.png" alt="" />
<img src="/images/2023-09-27-20-38-56.png" alt="" />
<img src="/images/2023-09-27-20-36-49.png" alt="" /></p>


    </div>
  </section>
  <hr>
  <footer>&copy pawan copyright 2022-2023</footer>
</body>



</html>
