<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta charset="utf-8">
  
  <title>Google Cloud Networking Overview</title>
  
  <title>MyBlog</title>
  <!-- <link href="/style.css" rel="stylesheet"/> -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link href="/style.css" rel="stylesheet"/>
</head>

<body>
  <nav>
</p>
<p style="font-size:25px;"><a href="/blog">Blogs</a>        <a href="/contact">contact</a>
    <!-- <a href="/blog">Blogs</a> -->
    <!-- <a href="/">Home</a> -->
    <!-- <a href="/about">About</a> -->
    <!-- <a href="/contact">Contact</a> -->
  <nav>
  <hr>
  <section class="section">
    <div class="container">
      
<h1 class="title">
  Google Cloud Networking Overview
</h1>
<p class="subtitle"><strong>2023-04-10</strong></p>
<p>Networking is the first thing I try to understand while working with cloud. Make my own networking segment and work on it unless I need to spin up a server for quick testing(making an isolated networking environment is an overkill and time consuming here). Google Cloud networking has a lot of moving components and  familiarity becomes normal if you interact with them on regular basis or at least repeatedly for some time. But knowing the top echelon helps to get started and fathom the vastness that lies beneath it. This is a good refresher if you are willing to get started with google cloud or want to remind yourself the networking aspects available within google cloud. If you have some knowledge of AWS networking, this is a easy follow through, if not pieces might not connect.</p>
<ul>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#regions-and-zones">Regions and zones</a></li>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#vpc">Vpc</a></li>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#route">Routes</a>
<ul>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#static-route">Static routes</a></li>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#dynamic-route">Dynamic routes</a></li>
</ul>
</li>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#firewall">Firewall</a></li>
<li><a href="https://pawanchhetri.com.np/blog/gcp-networking/#multiple-network-interfaces">Multiple network interfaces</a></li>
</ul>
<h4 id="regions-and-zones">Regions and zones</h4>
<p>GCP offers 37 regions(geographical locations) with 112 total zones/(isolated datacenters) as of now.  There are three zones per region, with the US-Central1 region having 4 zones.</p>
<p><img src="/images/2023-04-08-21-59-42.png" alt="" /></p>
<p>Check  <a href="https://cloud.google.com/about/locations/#regions">Region map</a> for more details regarding services availability across different regions and zones. At a minimum, all regions will offer the following products at launch: Compute Engine, Google Kubernetes Engine, Cloud Storage, Persistent Disk, CloudSQL, Virtual Private Cloud, Key Management System, Cloud Identity and Secret Manager.</p>
<h4 id="vpc">vpc</h4>
<p>Virtual Private Cloud(VPC) is a secure, individual, private cloud-computing model hosted within a public cloud like gcp, aws. VPC networks connect Google Cloud resources to each other and to the internet. Google VPC networks are global(unlike AWS) and can have subnets in any Google Cloud region worldwide. Subnets can span the zones that make up a region. Resources can even be in different zones on the same subnet. The size of the subnet can be increased by expanding the range of ip addresses allocated to it, and doing so won't affect virtual machines that are already configured. VPC have routing tables built-in, thus no router provisioning is needed. Traffic forwarding is done from one instance to another within the same network, across subnetworks, or even between Google Cloud zones without requiring an external IP address. Global firewall for both ingress and egress can be set at VPC level. Firewall rules can be defined using network tags on Compute Engine instances for fine grained control.
The default vpc has subnets in each region as below by default.</p>
<p><img src="/images/2023-04-09-14-30-15.png" alt="" /></p>
<p>If we delete a vpc,there will be no routes and no firewall rules associated with that vpc anymore, they get deleted by default. Same goes for default vpc. We can quickly make up for a default vpc by creating one with Automatic Subnet creation mode selected while creating new subnet. Default routes associated with this new vpc get created and also prompts for a default like firewall rules in this creation process.</p>
<p>VPCs belong to Google Cloud projects, if the VPCs of different projects need to talk to each other VPC peering. VPC networks are isolated private networking domains by default. VM instances within a VPC network can communicate among themselves by using internal IP addresses as long as firewall rules permit. However, no internal IP address communication is allowed between networks unless you set up mechanisms such as VPC peering or VPN. Projects can contain multiple VPC networks. New Projects start with a default network(an auto mode VPC network) that has one subnetwork(subnet) in each region.However, it’s a best practice to create a custom mode network and include subnetworks only in desired regions. </p>
<p><strong>Connecting external networks to Google VPC</strong>
<img src="/images/2023-04-08-21-49-05.png" alt="" /></p>
<ol>
<li>While Using IPsec VPN protocol Google  uses Cloud Router, which lets other networks and Google VPC, exchange route information over the VPN using the Border Gateway Protocol. Using this method, if you add a new subnet to your Google VPC, your on-premises network will automatically get routes to it. </li>
<li>Direct Peering means putting a router in the same public data center as a Google point of presence and using it to exchange traffic between networks. Google has more than 100 points of presence around the world. </li>
<li>Carrier peering gives you direct access from your on-premises network through a service provider's network to Google Workspace and to Google Cloud products that can be exposed through one or more public IP addresses. </li>
<li>If getting the highest uptimes for interconnection is important, using Dedicated Interconnect would be a good solution. </li>
<li>Partner Interconnect provides connectivity between an on-premises network and a VPC network through a supported service provider.</li>
</ol>
<h4 id="route">route</h4>
<p>A route is created when a vpc network is created, which enables traffic delivery from anywhere. Also, a route is created when a subnet is created. This is what allows VMs on the same network to communicate. Network tags fine-tune which route is picked. If a route has a network tag, it can be applied only to instances that have the same network tag. A route can be system-generated, custom, or peering. System-generated routes are simple and can be used by default. When they do not provide the desired granularity, create custom routes. For example, custom routes can be used to route traffic between subnets through a network virtual appliance. Peering routes are used for network peering. </p>
<p><img src="/images/2023-04-09-14-35-02.png" alt="" />
default routes for default vpc, 1st one is for external connectivity and other are for instances to talk to each other within same subnet.</p>
<p>When you create a VPC network, it includes a system-generated IPv4 default route (0.0.0.0/0). When you create a dual-stack subnet with an external IPv6 address range in a VPC network, a system-generated IPv6 default route (::/0) is added. When you create a subnet, system-generated subnet routes are automatically created.</p>
<h5 id="static-route">static route</h5>
<p>Custom static routes forward packets to a static route next hop and are useful for small, stable topologies. Dynamic routing generally provides quicker routing performance. Unlike dynamic routing, no processing power is devoted to maintaining and modifying the routes (hence the quicker performance). Custom static routing is more secure than dynamic routing, because there’s no route advertisement. Note these custom static routing limitations. A custom static route cannot point to a VLAN attachment. It also requires more maintenance, because routes are not dynamically updated. When you add or delete a route, the set of changes is propagated to the VM controllers.</p>
<h5 id="dynamic-route">dynamic route</h5>
<p>Dynamic routes are managed by Cloud Routers in the VPC network. Their destinations always represent IP address ranges outside your VPC network, which are received from a BGP peer router. BGP peer routers are typically outside the Google network (like on-premises or another cloud provider). Dynamic routes are used by </p>
<ul>
<li>Dedicated Interconnect</li>
<li>Partner Interconnect</li>
<li>HA VPN tunnels</li>
<li>Classic VPN tunnels that use dynamic routing</li>
</ul>
<h4 id="firewall">firewall</h4>
<p><img src="/images/2023-04-09-14-38-58.png" alt="" /></p>
<p>Default firewall rules, these firewall rules allow ICMP, RDP, and SSH ingress traffic from anywhere (0.0.0.0/0) and all TCP, UDP, and ICMP traffic within the internal network (10.128.0.0/9). default-allow-icmp allows pinging using external ip address from machines within vpc or from anywhere on the internet. allow-custom firewall rules allows pinging using internal ip address from machines within the same vpc regardeless of subnetworks. If we create vm instances now, we can SSH because of the allow-ssh firewall rule, which allows incoming traffic from anywhere (0.0.0.0/0) for tcp:22. The SSH connection works seamlessly because Compute Engine generates an SSH key for you and stores it in one of the following locations: By default, Compute Engine adds the generated key to project or instance metadata. If your account is configured to use OS Login, Compute Engine stores the generated key with your user account. Alternatively, you can control access to Linux instances by creating SSH keys and editing public SSH key metadata.  If we remove the allow-ssh rule, we can't ssh into the machines from the console or with using ssh keys.</p>
<p>If we choose  External IP addresses for VM instances as ephemeral when an instance is stopped, any ephemeral external IP addresses assigned to the instance are released back into the general Compute Engine pool and become available for use by other projects. When a stopped instance is started again, a new ephemeral external IP address is assigned to the instance. Alternatively, you can reserve a static external IP address, which assigns the address to your project indefinitely until you explicitly release it. </p>
<p>These defaults are shown while creating a custom vpc.
<img src="/images/2023-04-09-14-59-31.png" alt="" />
These are the same standard firewall rules that the default network had.
The deny-all-ingress and allow-all-egress rules are also displayed, but you cannot check or uncheck them because they are implied. These two rules have a lower Priority (higher integers indicate lower priorities) so that the allow ICMP, custom, RDP and SSH rules are considered first.</p>
<h4 id="multiple-network-interfaces">Multiple network interfaces</h4>
<p>A VM is allowed to have multiple network interfaces other than nic0(default).</p>
<p><img src="/images/2023-04-07-17-19-51.png" alt="" /></p>
<p>Each of the interfaces must have an internal IP address, and each interface can also have an external IP address. We might require multiple interfaces; for example, to configure an instance as a network appliance for load balancing. Multiple network interfaces are also useful when applications running in an instance require traffic separation, such as separation of data plane traffic from management plane traffic.Some caveats with multiple NICs are</p>
<ul>
<li>You can only configure a network interface when you create an instance.</li>
<li>Each network interface configured in a single instance must be attached to a different VPC network.</li>
<li>Each interface must belong to a subnet whose IP range does not overlap with the subnets
of any other interfaces.</li>
<li>The additional VPC networks that the multiple interfaces will attach to must exist before you create the instance.</li>
<li>You cannot delete a network interface without deleting the instance.</li>
</ul>
<p>When an internal DNS (Domain Name System) query is made with the instance hostname, it resolves to the primary interface (nic0) of the instance. If the nic0 interface of the instance belongs to a different VPC network than the instance that issues the internal DNS query, the query will fail.  The maximum number of network interfaces per instance is 8, but this depends on the instance's machine type.</p>
<p><em>Reference: Networking in Google Cloud: Defining and Implementing Networks(Coursera)</em></p>


    </div>
  </section>
  <hr>
  <footer>&copy pawan copyright 2022-2023</footer>
</body>



</html>
